<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<title>Killhope Android App Content Management</title>
		<meta name="generator" content="Bootply" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="css/custom.css" rel="stylesheet">
	</head>
	<body>
<div class="navbar navbar-default navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <img src="images/logo.png" id="nav-logo" class="img-responsive2"/>

    </div>
    <!--<div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </div>/.nav-collapse -->
		<H2 id="navbar-title" class="navbar-right"> <b>Android App </b>| Content Management </H2>
  </div>
</div>
<!-- Wrap all page content here -->
<div id="wrap">
<div class="container" id="change-type"> 
  <div class="text-center">
    <h1>What do you want to change?</h1>
        <p class="lead">Select below the type of content change you wish to make.</p>
        <p class="lead"> <button class="btn btn-primary btn-lg" id="minDat"> Mineral Data </button></p>
        <p class="lead"> <button class="btn btn-primary btn-lg" id="easyQuizDat" > Easy Quiz Questions </button> </p>
        <p class="lead"> <button class="btn btn-primary btn-lg" id="medQuizDat" > Medium Quiz Questions </button> </p>
        <p class="lead"> <button class="btn btn-primary btn-lg" id="hardQuizDat" > Hard Quiz Questions </button> </p>
        <p class="lead"> <button class="btn btn-primary btn-lg" id="glosDat"> Glossary </button> </p>
  </div>
</div><!-- /.container -->

<div class="container"> 
<div class="above-form clearfix">
   <div id="back-btn"> 
		<button id="back-to-home" class="btn btn-lg btn-primary"> <span id="back-icon" class="glyphicon glyphicon-chevron-left"></span></span> Back To Home </button>
   </div>
	<div id="form-buttons" class="btn-group">
		<button id="revert-original" class="btn btn-lg btn-danger"> Revert to Original </button>
		<button id="revert-last-save" class="btn btn-lg btn-warning"> Revert to Last Save </button>
		<button id="download-json" class="btn btn-lg btn-primary" target="_blank"> Download JSON </button>
		<button id="save-changes" class="btn btn-lg btn-success"> <span id="floppy-icon" class="glyphicon glyphicon-floppy-disk"></span> Save Changes </button>
	</div>
</div>
<div id="form">

</div>

</div><!-- /.container -->
</div><!-- /.wrap -->

<footer class="footer">
  <div class="container">

    <p class="text-muted">
	    Content Management System designed by Jonathan Berry.
    </p>
  </div>
</footer>

</body>
</html>


	<!-- script references -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
      <script src="js/jsoneditor.min.js"></script>
		<script src="js/schema.js"></script>  <!-- Stores the schema for each type of data -->
		<script type="text/javascript">

//------------------------------------------------------------------------------
//-------------------------THE JAVASCRIPT MACHINE ------------------------------
//------------------------------------------------------------------------------

$( document ).ready( function(){
var element = document.getElementById('form');

JSONEditor.defaults.theme = 'bootstrap3';
JSONEditor.defaults.iconlib = 'bootstrap3';

function showForm( formSchema, file, node=null ){
   var filePath = "../data/"+file;
	$('#change-type').hide();
   $('.above-form ').show();

	// Initialize the editor
	var editor = new JSONEditor(element, {no_additional_properties:true, schema:formSchema});
	
	// Get the saved JSON data.
   $.ajaxSetup({ cache: false });
	$.getJSON(filePath, function(json) {

			var minList={};
			
			//Create the mineral selector.
			var dropDown = "<div class='dropdown'><button class='btn btn-default dropdown-toggle' type='button' id='nodeSelector' data-toggle='dropdown'> Node <span class='caret'></span></button><ul>";
			for( var key in json ){
				minList[json[key].name] = key;
				dropDown = dropDown + "<li>< a href='#' minID='"+key+"'>"+json[key].name+"</a></li>";
			}
			dropDown = dropDown +"</ul></div>";
			console.log(dropDown);

			//Select the initial mineral to be edited. 
			if( node != null ) json = json[node];
			editor.setValue(json);
	});

	//Enable the save changes button.
	$('#save-changes').click( function(){
		console.log("Clicked");
		var json = JSON.stringify(editor.getValue());
      //console.log(btoa);
      //var encoded = btoa(json);

      var xhr = new XMLHttpRequest();
		xhr.open('POST','writeJSON.php',true);
		xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		xhr.send('json=' + json + '&file='+ filePath);
      xhr.onreadystatechange=function(){
			if (xhr.readyState==4 && xhr.status==200){
				alert("Changes Saved");			
			}
		}
	});


	//TODO: enable node selector. 

	//Enable the download JSON button. 
	$('#download-json').attr('href',filePath);

	//Enable the revert to original button.
	$('#revert-last-save').click( function(){
		if( confirm("Are you sure?\nYou will lose changes made since the last save.") ){
			$.getJSON(filePath, function(json) {
				editor.setValue(json);
			});
		}
	});

	//Enable the revert to original button.
	$('#revert-original').click( function(){
		if( confirm("Are you sure?\nThis will set the form's data back to factory settings.\nIF YOU THEN CLICK \"SAVE\", ALL PREVIOUSLY SAVED DATA CHANGES WILL BE LOST.") ){
			$.getJSON("data/original/"+file, function(json) {
				editor.setValue(json);
			});
		}
	});

	$('#back-to-home').click( function() {
		if( confirm("Are you sure?\nAny unsaved changes will be lost.") ){
			$('.above-form ').hide();
			editor.destroy();
 			$('#change-type').show();
		}
	});


}

$('#minDat').click( function() {

	
   $.ajaxSetup({ cache: false });
	$.getJSON("../data/MineralData.json", function(json) {
		var minerals = json;
		var id = "0";
		var minList ={};
		for( var key in minerals ){
			minList[json[key].name] = key;
		}
		console.log(minList);
	});

	//showForm( mineral_schema, "GlossaryData.json" );
});

$('#glosDat').click( function() {
	showForm( glossary_schema, "GlossaryData.json" );
});

$('#hardQuizDat').click( function() {
	showForm( hard_quiz_schema, "mineralquizhardfix.json" );
});

$('#medQuizDat').click( function() {
	showForm( med_quiz_schema, "mineralquizmedium.json" );
});

$('#easyQuizDat').click( function() {
	showForm( easy_quiz_schema, "mineralquizeasy.json" );
});


});



// Set the value
//editor.setValue({
//    name: "John Smith"
//});

// Get the value
//var data = editor.getValue();
//console.log(data.name); // "John Smith"

		</script>
